import{m as v,s as N,M as k,r as g,R as L,j as e,B as y,U as S,d as U,l as _}from"./index-BhnCGazT.js";import{P as D}from"./ProgressBar-B3LiunaO.js";import{M}from"./Modal-Bjrg86Tx.js";import{B as I}from"./Breadcrumbs-oO1jVnSr.js";import{E as B}from"./EmptyState-CvHK2i_K.js";const w=t=>new Promise(a=>setTimeout(a,t)),$=t=>{switch(t){case"not-started":case"in-progress":case"completed":case"blocked":return t;default:return"not-started"}},C={getGoalsByUserId:async t=>{if(v()){const{data:r,error:d}=await N.from("goals").select("*").or(`user_id.eq.${t},is_team_goal.eq.true`).order("created_at",{ascending:!1});return d?(console.error("Error fetching goals:",d),[]):(r||[]).map(o=>({id:o.id,title:o.title,description:o.description||"",owner:o.user_id,progress:o.progress,dueDate:o.due_date||"",status:$(o.status),category:o.category||"Professional",priority:o.priority||"Medium",estimatedTime:o.estimated_time||0,isTeamGoal:o.is_team_goal||!1,milestones:[],comments:[]}))}await w(300);const a=localStorage.getItem("zirtually_goals");return(a?JSON.parse(a):k).filter(r=>r.owner===t||r.isTeamGoal)},createGoal:async t=>{if(v()){const d={title:t.title,user_id:t.owner,description:t.description,progress:t.progress,status:t.status,due_date:t.dueDate||null,priority:t.priority,category:t.category,estimated_time:t.estimatedTime,is_team_goal:t.isTeamGoal},{data:i,error:o}=await N.from("goals").insert(d).select().single();if(o)throw new Error(o.message);if(!i)throw new Error("No data returned from create");return{...t,id:i.id}}await w(300);const a=localStorage.getItem("zirtually_goals"),l=a?JSON.parse(a):[...k],r={...t,id:`goal-${Date.now()}`};return l.push(r),localStorage.setItem("zirtually_goals",JSON.stringify(l)),r},updateGoal:async t=>{if(v()){const{error:d}=await N.from("goals").update({title:t.title,description:t.description,progress:t.progress,status:t.status,due_date:t.dueDate||null,priority:t.priority,category:t.category,estimated_time:t.estimatedTime,is_team_goal:t.isTeamGoal,updated_at:new Date().toISOString()}).eq("id",t.id).select().single();if(d)throw new Error(d.message);return t}await w(300);const a=localStorage.getItem("zirtually_goals"),l=a?JSON.parse(a):[...k],r=l.findIndex(d=>d.id===t.id);return r!==-1&&(l[r]=t),localStorage.setItem("zirtually_goals",JSON.stringify(l)),t},deleteGoal:async t=>{if(v()){const{error:r}=await N.from("goals").delete().eq("id",t);if(r)throw new Error(r.message);return}await w(300);const a=localStorage.getItem("zirtually_goals");let l=a?JSON.parse(a):[...k];l=l.filter(r=>r.id!==t),localStorage.setItem("zirtually_goals",JSON.stringify(l))}},z=({priority:t})=>{const a={High:"bg-rose-100 dark:bg-rose-900/50 text-rose-700 dark:text-rose-300",Medium:"bg-amber-100 dark:bg-amber-900/50 text-amber-700 dark:text-amber-300",Low:"bg-emerald-100 dark:bg-emerald-900/50 text-emerald-700 dark:text-emerald-300"};return e.jsx("span",{className:`px-2 py-0.5 text-xs font-medium rounded-full ${a[t]}`,children:t})},J=({goal:t,onUpdate:a,showOwner:l=!1})=>{const r=U.find(i=>i.id===t.owner),d=i=>i>=75?"success":i>=50?"default":i>=25?"warning":"danger";return e.jsxs("div",{className:"group relative bg-white dark:bg-slate-800 rounded-2xl border border-gray-200 dark:border-slate-700 p-6 hover:border-indigo-300 dark:hover:border-indigo-700 transition-all hover:shadow-lg",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.isTeamGoal&&e.jsx("span",{className:"px-2 py-0.5 text-xs font-medium bg-indigo-100 dark:bg-indigo-900/50 text-indigo-700 dark:text-indigo-300 rounded-full",children:"Team Goal"}),t.category&&e.jsx("span",{className:"px-2 py-0.5 text-xs font-medium bg-gray-100 dark:bg-slate-700 text-gray-600 dark:text-slate-300 rounded-full",children:t.category})]}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:t.title}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-slate-400 mt-1 line-clamp-2",children:t.description})]}),e.jsx("div",{className:"text-right",children:e.jsxs("span",{className:"text-2xl font-bold",style:{color:"var(--color-primary)"},children:[t.progress,"%"]})})]}),e.jsx(D,{progress:t.progress,variant:d(t.progress),className:"mb-4"}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[l&&r&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("img",{src:r.avatarUrl,alt:r.name,className:"w-6 h-6 rounded-full"}),e.jsx("span",{className:"text-gray-600 dark:text-slate-400",children:r.name})]}),e.jsx(z,{priority:t.priority})]}),e.jsxs("div",{className:"flex items-center gap-4 text-gray-500 dark:text-slate-400",children:[t.dueDate&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),new Date(t.dueDate).toLocaleDateString("en-US",{month:"short",day:"numeric"})]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),t.estimatedTime,"h"]})]})]}),e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-100 dark:border-slate-700",children:e.jsx("button",{onClick:()=>a(t),className:"w-full py-2 text-sm font-medium text-indigo-600 dark:text-indigo-400 hover:bg-gray-50 dark:hover:bg-slate-700/50 rounded-lg transition-colors",children:"Update Progress"})})]})},V=({user:t,setActiveView:a})=>{const[l,r]=g.useState([]),[,d]=g.useState(!0),[i,o]=g.useState("my"),[m,b]=g.useState(null),[u,G]=g.useState(0),[O,p]=g.useState(!1),[n,x]=g.useState({title:"",description:"",priority:"Medium",estimatedTime:10,dueDate:"",isTeamGoal:!1,category:""});L.useEffect(()=>{(async()=>{try{d(!0);const c=await C.getGoalsByUserId(t.id);r(c)}catch(c){console.error("Failed to load goals",c)}finally{d(!1)}})()},[t.id]);const h=l.filter(s=>s.owner===t.id&&!s.isTeamGoal),f=l.filter(s=>s.isTeamGoal),P=s=>{b(s),G(s.progress)},A=async()=>{if(!m)return;const s={...m,progress:u};r(c=>c.map(j=>j.id===m.id?s:j));try{await C.updateGoal(s),_(t,"UPDATE_GOAL",`Updated goal "${m.title}" to ${u}%`)}catch(c){console.error("Update failed",c)}b(null)},E=async()=>{if(!n.title||!n.description){alert("Please fill in title and description.");return}const s={id:`g-${Date.now()}`,progress:0,owner:t.id,status:"not-started",...n};r(c=>[...c,s]);try{await C.createGoal(s),_(t,"ADD_GOAL",`Created goal: "${s.title}"`)}catch(c){console.error("Create failed",c)}p(!1),x({title:"",description:"",priority:"Medium",estimatedTime:10,dueDate:"",isTeamGoal:!1,category:""})},T=s=>s.length===0?0:Math.round(s.reduce((c,j)=>c+j.progress,0)/s.length);return e.jsxs("div",{className:"space-y-6",children:[e.jsx(I,{items:[{label:"Work"},{label:"Goals"}],setActiveView:a}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Goals"}),e.jsx("p",{className:"text-gray-500 dark:text-slate-400 mt-1",children:"Track progress on your personal and team objectives."})]}),e.jsxs(y,{variant:"primary",onClick:()=>p(!0),children:[e.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Add Goal"]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-indigo-500 to-indigo-600 rounded-2xl p-6 text-white",children:[e.jsx("p",{className:"text-indigo-100 text-sm font-medium",children:"My Goals"}),e.jsx("p",{className:"text-3xl font-bold mt-2",children:h.length}),e.jsxs("p",{className:"text-indigo-100 text-sm mt-1",children:[T(h),"% avg progress"]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-violet-500 to-violet-600 rounded-2xl p-6 text-white",children:[e.jsx("p",{className:"text-violet-100 text-sm font-medium",children:"Team Goals"}),e.jsx("p",{className:"text-3xl font-bold mt-2",children:f.length}),e.jsxs("p",{className:"text-violet-100 text-sm mt-1",children:[T(f),"% avg progress"]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-emerald-500 to-emerald-600 rounded-2xl p-6 text-white",children:[e.jsx("p",{className:"text-emerald-100 text-sm font-medium",children:"On Track"}),e.jsx("p",{className:"text-3xl font-bold mt-2",children:l.filter(s=>s.progress>=50).length}),e.jsxs("p",{className:"text-emerald-100 text-sm mt-1",children:["of ",l.length," total goals"]})]})]}),e.jsx("div",{className:"border-b border-gray-200 dark:border-slate-700",children:e.jsxs("nav",{className:"flex gap-8",children:[e.jsxs("button",{onClick:()=>o("my"),className:`pb-4 text-sm font-medium border-b-2 transition-colors ${i==="my"?"border-indigo-500 text-indigo-600 dark:text-indigo-400":"border-transparent text-gray-500 hover:text-gray-700 dark:text-slate-400 dark:hover:text-slate-300"}`,children:["My Goals (",h.length,")"]}),[S.MANAGER,S.ADMIN].includes(t.role)&&e.jsxs("button",{onClick:()=>o("team"),className:`pb-4 text-sm font-medium border-b-2 transition-colors ${i==="team"?"border-indigo-500 text-indigo-600 dark:text-indigo-400":"border-transparent text-gray-500 hover:text-gray-700 dark:text-slate-400 dark:hover:text-slate-300"}`,children:["Team Goals (",f.length,")"]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6",children:[(i==="my"?h:f).map(s=>e.jsx(J,{goal:s,onUpdate:P,showOwner:i==="team"},s.id)),(i==="my"?h:f).length===0&&e.jsx("div",{className:"col-span-full",children:e.jsx(B,{title:i==="my"?"No personal goals yet":"No team goals found",description:i==="my"?"Start tracking your personal development and work objectives.":"Collaborate with your team by setting shared goals.",actionLabel:"Create First Goal",onAction:()=>p(!0),icon:"ðŸŽ¯"})})]}),e.jsx(M,{isOpen:!!m,onClose:()=>b(null),title:`Update: ${m==null?void 0:m.title}`,children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-slate-300 mb-2",children:"Progress"}),e.jsx("input",{type:"range",min:"0",max:"100",value:u,onChange:s=>G(parseInt(s.target.value)),className:"w-full h-2 bg-gray-200 dark:bg-slate-700 rounded-lg appearance-none cursor-pointer"}),e.jsxs("div",{className:"flex justify-between text-sm text-gray-500 dark:text-slate-400 mt-2",children:[e.jsx("span",{children:"0%"}),e.jsxs("span",{className:"text-2xl font-bold text-indigo-600 dark:text-indigo-400",children:[u,"%"]}),e.jsx("span",{children:"100%"})]})]}),e.jsx(D,{progress:u,variant:"gradient",className:"h-4"}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(y,{variant:"secondary",onClick:()=>b(null),children:"Cancel"}),e.jsx(y,{variant:"primary",onClick:A,children:"Save Progress"})]})]})}),e.jsx(M,{isOpen:O,onClose:()=>p(!1),title:"Create New Goal",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-slate-300 mb-1",children:"Title"}),e.jsx("input",{type:"text",value:n.title,onChange:s=>x({...n,title:s.target.value}),className:"w-full px-4 py-2 bg-gray-50 dark:bg-slate-700 border border-gray-200 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-indigo-500",placeholder:"Enter goal title..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-slate-300 mb-1",children:"Description"}),e.jsx("textarea",{value:n.description,onChange:s=>x({...n,description:s.target.value}),rows:3,className:"w-full px-4 py-2 bg-gray-50 dark:bg-slate-700 border border-gray-200 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-indigo-500",placeholder:"Describe your goal..."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-slate-300 mb-1",children:"Priority"}),e.jsxs("select",{value:n.priority,onChange:s=>x({...n,priority:s.target.value}),className:"w-full px-4 py-2 bg-gray-50 dark:bg-slate-700 border border-gray-200 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"High",children:"High"}),e.jsx("option",{value:"Medium",children:"Medium"}),e.jsx("option",{value:"Low",children:"Low"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-slate-300 mb-1",children:"Category"}),e.jsxs("select",{value:n.category,onChange:s=>x({...n,category:s.target.value}),className:"w-full px-4 py-2 bg-gray-50 dark:bg-slate-700 border border-gray-200 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"",children:"Select Category"}),e.jsx("option",{value:"Professional",children:"Professional"}),e.jsx("option",{value:"Technical",children:"Technical"}),e.jsx("option",{value:"Leadership",children:"Leadership"}),e.jsx("option",{value:"Personal",children:"Personal"}),e.jsx("option",{value:"Compliance",children:"Compliance"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-slate-300 mb-1",children:"Estimated Time (h)"}),e.jsx("input",{type:"number",value:n.estimatedTime,onChange:s=>x({...n,estimatedTime:parseInt(s.target.value)||0}),min:"0",className:"w-full px-4 py-2 bg-gray-50 dark:bg-slate-700 border border-gray-200 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-slate-300 mb-1",children:"Due Date"}),e.jsx("input",{type:"date",value:n.dueDate,onChange:s=>x({...n,dueDate:s.target.value}),className:"w-full px-4 py-2 bg-gray-50 dark:bg-slate-700 border border-gray-200 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-indigo-500"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"isTeamGoal",checked:n.isTeamGoal,onChange:s=>x({...n,isTeamGoal:s.target.checked}),className:"w-4 h-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"}),e.jsx("label",{htmlFor:"isTeamGoal",className:"text-sm text-gray-700 dark:text-slate-300",children:"This is a team goal"})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx(y,{variant:"secondary",onClick:()=>p(!1),children:"Cancel"}),e.jsx(y,{variant:"primary",onClick:E,children:"Create Goal"})]})]})})]})};export{V as default};
