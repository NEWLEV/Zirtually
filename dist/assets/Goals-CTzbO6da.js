import{m as v,s as N,M as k,u as I,r as g,R as B,j as e,B as b,U as O,d as z,l as D}from"./index-jXBNcpIP.js";import{P as L}from"./ProgressBar-fP59PQhY.js";import{M as A}from"./Modal-DwonlL4D.js";import{B as $}from"./Breadcrumbs-CVKU9S1J.js";import{E as J}from"./EmptyState-ChLHD7-l.js";const w=t=>new Promise(r=>setTimeout(r,t)),G={getGoalsByUserId:async t=>{if(v()){const{data:a,error:o}=await N.from("goals").select("*").eq("user_id",t).order("created_at",{ascending:!1});return o?(console.error("Error fetching goals:",o),[]):a||[]}await w(300);const r=localStorage.getItem("zirtually_goals");return(r?JSON.parse(r):k).filter(a=>a.owner===t)},createGoal:async t=>{if(v()){const{data:o,error:d}=await N.from("goals").insert(t).select().single();if(d)throw new Error(d.message);return o}await w(300);const r=localStorage.getItem("zirtually_goals"),l=r?JSON.parse(r):[...k],a={...t};return l.push(a),localStorage.setItem("zirtually_goals",JSON.stringify(l)),a},updateGoal:async t=>{if(v()){const{data:o,error:d}=await N.from("goals").update({title:t.title,description:t.description,progress:t.progress,updated_at:new Date().toISOString()}).eq("id",t.id).select().single();if(d)throw new Error(d.message);return o}await w(300);const r=localStorage.getItem("zirtually_goals"),l=r?JSON.parse(r):[...k],a=l.findIndex(o=>o.id===t.id);return a!==-1&&(l[a]=t),localStorage.setItem("zirtually_goals",JSON.stringify(l)),t},deleteGoal:async t=>{if(v()){const{error:a}=await N.from("goals").delete().eq("id",t);if(a)throw new Error(a.message);return}await w(300);const r=localStorage.getItem("zirtually_goals");let l=r?JSON.parse(r):[...k];l=l.filter(a=>a.id!==t),localStorage.setItem("zirtually_goals",JSON.stringify(l))}},R=({priority:t})=>{const r={High:"bg-rose-100 dark:bg-rose-900/50 text-rose-700 dark:text-rose-300",Medium:"bg-amber-100 dark:bg-amber-900/50 text-amber-700 dark:text-amber-300",Low:"bg-emerald-100 dark:bg-emerald-900/50 text-emerald-700 dark:text-emerald-300"};return e.jsx("span",{className:`px-2 py-0.5 text-xs font-medium rounded-full ${r[t]}`,children:t})},H=({goal:t,onUpdate:r,showOwner:l=!1})=>{const a=z.find(d=>d.id===t.owner),o=d=>d>=75?"success":d>=50?"default":d>=25?"warning":"danger";return e.jsxs("div",{className:"group relative bg-white dark:bg-slate-800 rounded-2xl border border-gray-200 dark:border-slate-700 p-6 hover:border-indigo-300 dark:hover:border-indigo-700 transition-all hover:shadow-lg",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.isTeamGoal&&e.jsx("span",{className:"px-2 py-0.5 text-xs font-medium bg-indigo-100 dark:bg-indigo-900/50 text-indigo-700 dark:text-indigo-300 rounded-full",children:"Team Goal"}),t.category&&e.jsx("span",{className:"px-2 py-0.5 text-xs font-medium bg-gray-100 dark:bg-slate-700 text-gray-600 dark:text-slate-300 rounded-full",children:t.category})]}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:t.title}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-slate-400 mt-1 line-clamp-2",children:t.description})]}),e.jsx("div",{className:"text-right",children:e.jsxs("span",{className:"text-2xl font-bold",style:{color:"var(--color-primary)"},children:[t.progress,"%"]})})]}),e.jsx(L,{progress:t.progress,variant:o(t.progress),className:"mb-4"}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[l&&a&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("img",{src:a.avatarUrl,alt:a.name,className:"w-6 h-6 rounded-full"}),e.jsx("span",{className:"text-gray-600 dark:text-slate-400",children:a.name})]}),e.jsx(R,{priority:t.priority})]}),e.jsxs("div",{className:"flex items-center gap-4 text-gray-500 dark:text-slate-400",children:[t.targetDate&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),new Date(t.targetDate).toLocaleDateString("en-US",{month:"short",day:"numeric"})]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),t.estimatedTime,"h"]})]})]}),e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-100 dark:border-slate-700",children:e.jsx("button",{onClick:()=>r(t),className:"w-full py-2 text-sm font-medium text-indigo-600 dark:text-indigo-400 hover:bg-gray-50 dark:hover:bg-slate-700/50 rounded-lg transition-colors",children:"Update Progress"})})]})},Q=({user:t,setActiveView:r})=>{const{config:l}=I(),[a,o]=g.useState([]),[d,S]=g.useState(!0),[m,C]=g.useState("my"),[c,y]=g.useState(null),[h,T]=g.useState(0),[P,p]=g.useState(!1),[i,x]=g.useState({title:"",description:"",priority:"Medium",estimatedTime:10,targetDate:"",isTeamGoal:!1,category:""});B.useEffect(()=>{(async()=>{try{S(!0);const n=await G.getGoalsByUserId(t.id);o(n)}catch(n){console.error("Failed to load goals",n)}finally{S(!1)}})()},[t.id]);const u=a.filter(s=>s.owner===t.id&&!s.isTeamGoal),f=a.filter(s=>s.isTeamGoal),U=s=>{y(s),T(s.progress)},_=async()=>{if(!c)return;const s={...c,progress:h};o(n=>n.map(j=>j.id===c.id?s:j));try{await G.updateGoal(s),D(t,"UPDATE_GOAL",`Updated goal "${c.title}" to ${h}%`)}catch(n){console.error("Update failed",n)}y(null)},E=async()=>{if(!i.title||!i.description){alert("Please fill in title and description.");return}const s={id:`g-${Date.now()}`,progress:0,owner:t.id,...i};o(n=>[...n,s]);try{await G.createGoal(s),D(t,"ADD_GOAL",`Created goal: "${s.title}"`)}catch(n){console.error("Create failed",n)}p(!1),x({title:"",description:"",priority:"Medium",estimatedTime:10,targetDate:"",isTeamGoal:!1,category:""})},M=s=>s.length===0?0:Math.round(s.reduce((n,j)=>n+j.progress,0)/s.length);return e.jsxs("div",{className:"space-y-6",children:[e.jsx($,{items:[{label:"Work"},{label:"Goals"}],setActiveView:r}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Goals"}),e.jsx("p",{className:"text-gray-500 dark:text-slate-400 mt-1",children:"Track progress on your personal and team objectives."})]}),e.jsxs(b,{variant:"primary",onClick:()=>p(!0),children:[e.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Add Goal"]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-indigo-500 to-indigo-600 rounded-2xl p-6 text-white",children:[e.jsx("p",{className:"text-indigo-100 text-sm font-medium",children:"My Goals"}),e.jsx("p",{className:"text-3xl font-bold mt-2",children:u.length}),e.jsxs("p",{className:"text-indigo-100 text-sm mt-1",children:[M(u),"% avg progress"]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-violet-500 to-violet-600 rounded-2xl p-6 text-white",children:[e.jsx("p",{className:"text-violet-100 text-sm font-medium",children:"Team Goals"}),e.jsx("p",{className:"text-3xl font-bold mt-2",children:f.length}),e.jsxs("p",{className:"text-violet-100 text-sm mt-1",children:[M(f),"% avg progress"]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-emerald-500 to-emerald-600 rounded-2xl p-6 text-white",children:[e.jsx("p",{className:"text-emerald-100 text-sm font-medium",children:"On Track"}),e.jsx("p",{className:"text-3xl font-bold mt-2",children:a.filter(s=>s.progress>=50).length}),e.jsxs("p",{className:"text-emerald-100 text-sm mt-1",children:["of ",a.length," total goals"]})]})]}),e.jsx("div",{className:"border-b border-gray-200 dark:border-slate-700",children:e.jsxs("nav",{className:"flex gap-8",children:[e.jsxs("button",{onClick:()=>C("my"),className:`pb-4 text-sm font-medium border-b-2 transition-colors ${m==="my"?"border-indigo-500 text-indigo-600 dark:text-indigo-400":"border-transparent text-gray-500 hover:text-gray-700 dark:text-slate-400 dark:hover:text-slate-300"}`,children:["My Goals (",u.length,")"]}),[O.MANAGER,O.ADMIN].includes(t.role)&&e.jsxs("button",{onClick:()=>C("team"),className:`pb-4 text-sm font-medium border-b-2 transition-colors ${m==="team"?"border-indigo-500 text-indigo-600 dark:text-indigo-400":"border-transparent text-gray-500 hover:text-gray-700 dark:text-slate-400 dark:hover:text-slate-300"}`,children:["Team Goals (",f.length,")"]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6",children:[(m==="my"?u:f).map(s=>e.jsx(H,{goal:s,onUpdate:U,showOwner:m==="team"},s.id)),(m==="my"?u:f).length===0&&e.jsx("div",{className:"col-span-full",children:e.jsx(J,{title:m==="my"?"No personal goals yet":"No team goals found",description:m==="my"?"Start tracking your personal development and work objectives.":"Collaborate with your team by setting shared goals.",actionLabel:"Create First Goal",onAction:()=>p(!0),icon:"ðŸŽ¯"})})]}),e.jsx(A,{isOpen:!!c,onClose:()=>y(null),title:`Update: ${c==null?void 0:c.title}`,children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-slate-300 mb-2",children:"Progress"}),e.jsx("input",{type:"range",min:"0",max:"100",value:h,onChange:s=>T(parseInt(s.target.value)),className:"w-full h-2 bg-gray-200 dark:bg-slate-700 rounded-lg appearance-none cursor-pointer"}),e.jsxs("div",{className:"flex justify-between text-sm text-gray-500 dark:text-slate-400 mt-2",children:[e.jsx("span",{children:"0%"}),e.jsxs("span",{className:"text-2xl font-bold text-indigo-600 dark:text-indigo-400",children:[h,"%"]}),e.jsx("span",{children:"100%"})]})]}),e.jsx(L,{progress:h,variant:"gradient",className:"h-4"}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(b,{variant:"secondary",onClick:()=>y(null),children:"Cancel"}),e.jsx(b,{variant:"primary",onClick:_,children:"Save Progress"})]})]})}),e.jsx(A,{isOpen:P,onClose:()=>p(!1),title:"Create New Goal",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-slate-300 mb-1",children:"Title"}),e.jsx("input",{type:"text",value:i.title,onChange:s=>x({...i,title:s.target.value}),className:"w-full px-4 py-2 bg-gray-50 dark:bg-slate-700 border border-gray-200 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-indigo-500",placeholder:"Enter goal title..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-slate-300 mb-1",children:"Description"}),e.jsx("textarea",{value:i.description,onChange:s=>x({...i,description:s.target.value}),rows:3,className:"w-full px-4 py-2 bg-gray-50 dark:bg-slate-700 border border-gray-200 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-indigo-500",placeholder:"Describe your goal..."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-slate-300 mb-1",children:"Priority"}),e.jsxs("select",{value:i.priority,onChange:s=>x({...i,priority:s.target.value}),className:"w-full px-4 py-2 bg-gray-50 dark:bg-slate-700 border border-gray-200 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"High",children:"High"}),e.jsx("option",{value:"Medium",children:"Medium"}),e.jsx("option",{value:"Low",children:"Low"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-slate-300 mb-1",children:"Target Date"}),e.jsx("input",{type:"date",value:i.targetDate,onChange:s=>x({...i,targetDate:s.target.value}),className:"w-full px-4 py-2 bg-gray-50 dark:bg-slate-700 border border-gray-200 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-indigo-500"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"isTeamGoal",checked:i.isTeamGoal,onChange:s=>x({...i,isTeamGoal:s.target.checked}),className:"w-4 h-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"}),e.jsx("label",{htmlFor:"isTeamGoal",className:"text-sm text-gray-700 dark:text-slate-300",children:"This is a team goal"})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx(b,{variant:"secondary",onClick:()=>p(!1),children:"Cancel"}),e.jsx(b,{variant:"primary",onClick:E,children:"Create Goal"})]})]})})]})};export{Q as default};
