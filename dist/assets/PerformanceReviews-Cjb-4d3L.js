import{m as S,s as A,n as C,r as j,o as T,j as e,P as q,C as h,B as y,p as $}from"./index-jXBNcpIP.js";import{M as F}from"./Modal-DwonlL4D.js";import{P as J}from"./ProgressBar-fP59PQhY.js";import{B as K}from"./Breadcrumbs-CVKU9S1J.js";const D=a=>new Promise(n=>setTimeout(n,a)),O={getReviewsByEmployeeId:async a=>{if(S()){const{data:l,error:d}=await A.from("performance_reviews").select("*").eq("employee_id",a);return d?(console.error("Error fetching reviews:",d),[]):l||[]}await D(400);const n=localStorage.getItem("zirtually_reviews");return(n?JSON.parse(n):C).filter(l=>l.employeeId===a)},getManagedReviews:async a=>{if(S()){const{data:l,error:d}=await A.from("performance_reviews").select("*").eq("reviewer_id",a);return d?(console.error("Error fetching managed reviews:",d),[]):l||[]}await D(400);const n=localStorage.getItem("zirtually_reviews");return(n?JSON.parse(n):C).filter(l=>l.managerId===a)},updateReview:async a=>{if(S()){const{data:d,error:p}=await A.from("performance_reviews").update({status:a.status,overall_rating:a.overallRating,strengths:a.strengths,areas_for_improvement:a.areasForImprovement,updated_at:new Date().toISOString()}).eq("id",a.id).select().single();if(p)throw new Error(p.message);return d}await D(300);const n=localStorage.getItem("zirtually_reviews"),c=n?JSON.parse(n):[...C],l=c.findIndex(d=>d.id===a.id);return l!==-1&&(c[l]=a),localStorage.setItem("zirtually_reviews",JSON.stringify(c)),a}},V=({user:a,setActiveView:n})=>{var P,G;const[c,l]=j.useState([]),[d,p]=j.useState(!0),[s,z]=j.useState(null),[B,f]=j.useState(!1);j.useEffect(()=>{(async()=>{try{p(!0);const r=await O.getReviewsByEmployeeId(a.id);l(r)}catch(r){console.error("Failed to load reviews",r)}finally{p(!1)}})()},[a.id]);const[v,_]=T("review_drafts",{}),I=t=>{switch(t){case"completed":return"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400";case"in_progress":return"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400";case"pending":return"bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-400";case"scheduled":return"bg-gray-100 dark:bg-slate-700 text-gray-600 dark:text-slate-400";default:return"bg-gray-100 dark:bg-slate-700 text-gray-600 dark:text-slate-400"}},L=t=>{if(!t.selfAssessment)return null;const r=[t.selfAssessment.performanceRating,t.selfAssessment.goalsAchievement,t.selfAssessment.skillsGrowth,t.selfAssessment.teamwork,t.selfAssessment.initiative];return(r.reduce((x,o)=>x+o,0)/r.length).toFixed(1)},u=c.filter(t=>t.status==="pending"||t.status==="in_progress"),w=c.filter(t=>t.status==="completed"),N=c.filter(t=>t.status==="scheduled"),R=t=>{z(t),f(!0)},k=(t,r,x,o)=>{_(m=>{const g=m[t]||{};return o?{...m,[t]:{...g,[r]:{...g[r]||{},[o]:x}}}:{...m,[t]:{...g,[r]:x}}})},M=async()=>{var x,o,m,g,b;if(!s)return;const t=v[s.id]||{},r={...s,status:"completed",completedDate:new Date().toISOString(),selfAssessment:{performanceRating:((x=t.Performance)==null?void 0:x.rating)||0,goalsAchievement:((o=t["Goals Achievement"])==null?void 0:o.rating)||0,skillsGrowth:((m=t["Skills Growth"])==null?void 0:m.rating)||0,teamwork:((g=t.Teamwork)==null?void 0:g.rating)||0,initiative:((b=t.Initiative)==null?void 0:b.rating)||0,achievements:(t.achievements||"").split(`
`)}};l(c.map(i=>i.id===s.id?r:i));try{await O.updateReview(r)}catch(i){console.error("Submission failed",i)}f(!1),_(i=>{const E={...i};return delete E[s.id],E})};return d?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(K,{items:[{label:"Work"},{label:"Performance Reviews"}],setActiveView:n}),e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gradient-to-br from-amber-500 to-orange-600 rounded-xl text-white",children:e.jsx(q,{className:"w-6 h-6"})}),"Performance Reviews"]}),e.jsx("p",{className:"text-gray-500 dark:text-slate-400 mt-1",children:"Track your growth and feedback throughout the year"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(h,{variant:"glass",padding:"md",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-slate-400",children:"Pending Reviews"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900 dark:text-white mt-1",children:u.length})]}),e.jsxs(h,{variant:"glass",padding:"md",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-slate-400",children:"Completed This Year"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900 dark:text-white mt-1",children:w.length})]}),e.jsxs(h,{variant:"glass",padding:"md",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-slate-400",children:"Upcoming"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900 dark:text-white mt-1",children:N.length})]}),e.jsxs(h,{variant:"glass",padding:"md",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-slate-400",children:"Average Rating"}),e.jsxs("p",{className:"text-3xl font-bold text-gray-900 dark:text-white mt-1",children:[w.length>0?"4.2":"-","/5"]})]})]}),u.length>0&&e.jsx(h,{variant:"elevated",className:"border-l-4 border-l-amber-500",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Action Required"}),e.jsxs("p",{className:"text-gray-500 dark:text-slate-400 mt-1",children:["You have ",u.length," review(s) that need your attention"]})]}),e.jsx(y,{onClick:()=>u[0]&&R(u[0]),children:"Start Review"})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(h,{variant:"bordered",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Current Reviews"}),e.jsxs("div",{className:"space-y-4",children:[[...u,...N].map(t=>e.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-slate-800/50 rounded-xl hover:bg-gray-100 dark:hover:bg-slate-800 transition-colors cursor-pointer",onClick:()=>R(t),children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-gray-900 dark:text-white",children:[t.period," Review"]}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-slate-400",children:["Due: ",new Date(t.dueDate).toLocaleDateString()]})]}),e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${I(t.status)}`,children:t.status.replace("_"," ")})]}),t.status==="in_progress"&&e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 dark:text-slate-400 mb-1",children:[e.jsx("span",{children:"Progress"}),e.jsx("span",{children:"60%"})]}),e.jsx(J,{value:60,variant:"gradient",size:"sm"})]})]},t.id)),u.length===0&&N.length===0&&e.jsx("p",{className:"text-center text-gray-500 dark:text-slate-400 py-8",children:"No current reviews"})]})]}),e.jsxs(h,{variant:"bordered",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Review History"}),e.jsxs("div",{className:"space-y-4",children:[w.map(t=>e.jsx("div",{className:"p-4 bg-gray-50 dark:bg-slate-800/50 rounded-xl hover:bg-gray-100 dark:hover:bg-slate-800 transition-colors cursor-pointer",onClick:()=>R(t),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-gray-900 dark:text-white flex items-center gap-2",children:[t.period," Review",e.jsx($,{className:"w-4 h-4 text-green-500"})]}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-slate-400",children:["Completed:"," ",t.completedDate?new Date(t.completedDate).toLocaleDateString():"N/A"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:L(t)||"-"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-slate-400",children:"Overall"})]})]})},t.id)),w.length===0&&e.jsx("p",{className:"text-center text-gray-500 dark:text-slate-400 py-8",children:"No completed reviews yet"})]})]})]}),e.jsxs(h,{variant:"glass",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Tips for a Great Self-Assessment"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"p-4 bg-white/50 dark:bg-slate-800/50 rounded-xl",children:[e.jsx("div",{className:"text-2xl mb-2",children:"ðŸ“Š"}),e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:"Use Data"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-slate-400 mt-1",children:"Back up your achievements with specific metrics and examples"})]}),e.jsxs("div",{className:"p-4 bg-white/50 dark:bg-slate-800/50 rounded-xl",children:[e.jsx("div",{className:"text-2xl mb-2",children:"ðŸŽ¯"}),e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:"Align with Goals"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-slate-400 mt-1",children:"Reference your quarterly goals and how you've progressed"})]}),e.jsxs("div",{className:"p-4 bg-white/50 dark:bg-slate-800/50 rounded-xl",children:[e.jsx("div",{className:"text-2xl mb-2",children:"ðŸ’¬"}),e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:"Be Honest"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-slate-400 mt-1",children:"Acknowledge challenges and areas where you want to grow"})]})]})]}),e.jsx(F,{isOpen:B,onClose:()=>f(!1),title:`${(s==null?void 0:s.period)||""} Performance Review`,size:"xl",children:s&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 dark:bg-slate-800 rounded-xl",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-slate-400",children:"Review Period"}),e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:s.period})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-slate-400",children:"Due Date"}),e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:new Date(s.dueDate).toLocaleDateString()})]}),e.jsx("span",{className:`px-3 py-1 text-sm rounded-full ${I(s.status)}`,children:s.status.replace("_"," ")})]}),(s.status==="pending"||s.status==="in_progress")&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white",children:"Self Assessment"}),["Performance","Goals Achievement","Skills Growth","Teamwork","Initiative"].map(t=>{var o,m,g,b;const r=(m=(o=v[s.id])==null?void 0:o[t])==null?void 0:m.rating,x=((b=(g=v[s.id])==null?void 0:g[t])==null?void 0:b.comment)||"";return e.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-slate-800 rounded-xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("label",{className:"font-medium text-gray-900 dark:text-white",children:t}),e.jsx("div",{className:"flex gap-1",children:[1,2,3,4,5].map(i=>e.jsx("button",{onClick:()=>k(s.id,t,i,"rating"),className:`w-8 h-8 rounded-lg text-sm font-medium transition-colors ${r===i?"bg-indigo-600 text-white":"bg-gray-200 dark:bg-slate-700 text-gray-600 dark:text-slate-400 hover:bg-indigo-100 dark:hover:bg-indigo-900/30 hover:text-indigo-600 dark:hover:text-indigo-400"}`,children:i},i))})]}),e.jsx("textarea",{value:x,onChange:i=>k(s.id,t,i.target.value,"comment"),placeholder:`Describe your ${t.toLowerCase()} this period...`,className:"w-full p-3 bg-white dark:bg-slate-700 rounded-lg text-sm text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-slate-500 outline-none focus:ring-2 focus:ring-indigo-500 resize-none",rows:2})]},t)}),e.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-slate-800 rounded-xl",children:[e.jsx("label",{className:"font-medium text-gray-900 dark:text-white mb-3 block",children:"Key Achievements"}),e.jsx("textarea",{value:((P=v[s.id])==null?void 0:P.achievements)||"",onChange:t=>k(s.id,"achievements",t.target.value),placeholder:"List your main accomplishments this period...",className:"w-full p-3 bg-white dark:bg-slate-700 rounded-lg text-sm text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-slate-500 outline-none focus:ring-2 focus:ring-indigo-500 resize-none",rows:4})]}),e.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-slate-800 rounded-xl",children:[e.jsx("label",{className:"font-medium text-gray-900 dark:text-white mb-3 block",children:"Areas for Growth"}),e.jsx("textarea",{value:((G=v[s.id])==null?void 0:G.growth)||"",onChange:t=>k(s.id,"growth",t.target.value),placeholder:"What areas would you like to develop?",className:"w-full p-3 bg-white dark:bg-slate-700 rounded-lg text-sm text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-slate-500 outline-none focus:ring-2 focus:ring-indigo-500 resize-none",rows:3})]})]}),s.status==="completed"&&s.selfAssessment&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white",children:"Your Assessment"}),e.jsx("div",{className:"grid grid-cols-5 gap-3",children:[{label:"Performance",value:s.selfAssessment.performanceRating},{label:"Goals",value:s.selfAssessment.goalsAchievement},{label:"Skills",value:s.selfAssessment.skillsGrowth},{label:"Teamwork",value:s.selfAssessment.teamwork},{label:"Initiative",value:s.selfAssessment.initiative}].map(t=>e.jsxs("div",{className:"text-center p-3 bg-gray-50 dark:bg-slate-800 rounded-xl",children:[e.jsx("p",{className:"text-2xl font-bold text-indigo-600 dark:text-indigo-400",children:t.value}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-slate-400 mt-1",children:t.label})]},t.label))}),e.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-slate-800 rounded-xl",children:[e.jsx("h5",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"Key Achievements"}),e.jsx("ul",{className:"list-disc list-inside space-y-1 text-sm text-gray-600 dark:text-slate-300",children:s.selfAssessment.achievements.map((t,r)=>e.jsx("li",{children:t},r))})]}),s.managerAssessment&&e.jsxs("div",{className:"p-4 bg-indigo-50 dark:bg-indigo-900/20 rounded-xl border border-indigo-200 dark:border-indigo-800",children:[e.jsx("h5",{className:"font-medium text-indigo-900 dark:text-indigo-200 mb-2",children:"Manager Feedback"}),e.jsx("p",{className:"text-sm text-indigo-700 dark:text-indigo-300",children:s.managerAssessment.feedback})]})]}),e.jsx("div",{className:"flex gap-3 pt-4 border-t border-gray-200 dark:border-slate-700",children:s.status==="pending"||s.status==="in_progress"?e.jsxs(e.Fragment,{children:[e.jsx(y,{variant:"secondary",className:"flex-1",onClick:()=>f(!1),children:"Save Draft"}),e.jsx(y,{className:"flex-1",onClick:M,children:"Submit Review"})]}):e.jsx(y,{variant:"secondary",className:"flex-1",onClick:()=>f(!1),children:"Close"})})]})})]})};export{V as default};
