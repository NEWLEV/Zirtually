import{m as A,s as S,n as R,r as v,o as M,j as e,P as q,C as h,B as k,p as $}from"./index-BhnCGazT.js";import{M as J}from"./Modal-Bjrg86Tx.js";import{P as K}from"./ProgressBar-B3LiunaO.js";import{B as W}from"./Breadcrumbs-oO1jVnSr.js";const D=a=>new Promise(n=>setTimeout(n,a)),O=a=>{switch(a){case"draft":return"pending";case"submitted":return"in_progress";case"completed":return"completed";default:return"pending"}},Y=a=>{switch(a){case"pending":case"scheduled":return"draft";case"in_progress":return"submitted";case"completed":return"completed";default:return"draft"}},T={getReviewsByEmployeeId:async a=>{if(A()){const{data:l,error:d}=await S.from("performance_reviews").select("*").eq("employee_id",a);return d?(console.error("Error fetching reviews:",d),[]):(l||[]).map(s=>({id:s.id,employeeId:s.employee_id,managerId:s.reviewer_id,period:s.period,status:O(s.status),dueDate:s.due_date||s.created_at,overallRating:s.overall_rating||void 0,selfAssessment:s.self_assessment||void 0,managerAssessment:s.manager_assessment||void 0,strengths:s.strengths||void 0,areasForImprovement:s.areas_for_improvement||void 0,goalsNextPeriod:s.goals_next_period||void 0}))}await D(400);const n=localStorage.getItem("zirtually_reviews");return(n?JSON.parse(n):R).filter(l=>l.employeeId===a)},getManagedReviews:async a=>{if(A()){const{data:l,error:d}=await S.from("performance_reviews").select("*").eq("reviewer_id",a);return d?(console.error("Error fetching managed reviews:",d),[]):(l||[]).map(s=>({id:s.id,employeeId:s.employee_id,managerId:s.reviewer_id,period:s.period,status:O(s.status),dueDate:s.due_date||s.created_at,overallRating:s.overall_rating||void 0,selfAssessment:s.self_assessment||void 0,managerAssessment:s.manager_assessment||void 0,strengths:s.strengths||void 0,areasForImprovement:s.areas_for_improvement||void 0,goalsNextPeriod:s.goals_next_period||void 0}))}await D(400);const n=localStorage.getItem("zirtually_reviews");return(n?JSON.parse(n):R).filter(l=>l.managerId===a)},updateReview:async a=>{if(A()){const{error:d}=await S.from("performance_reviews").update({status:Y(a.status),overall_rating:a.overallRating,strengths:a.strengths,areas_for_improvement:a.areasForImprovement,goals_next_period:a.goalsNextPeriod,due_date:a.dueDate,self_assessment:a.selfAssessment,manager_assessment:a.managerAssessment,updated_at:new Date().toISOString()}).eq("id",a.id).select().single();if(d)throw new Error(d.message);return a}await D(300);const n=localStorage.getItem("zirtually_reviews"),o=n?JSON.parse(n):[...R],l=o.findIndex(d=>d.id===a.id);return l!==-1&&(o[l]=a),localStorage.setItem("zirtually_reviews",JSON.stringify(o)),a}},X=({user:a,setActiveView:n})=>{var P,G;const[o,l]=v.useState([]),[d,b]=v.useState(!0),[s,z]=v.useState(null),[B,f]=v.useState(!1);v.useEffect(()=>{(async()=>{try{b(!0);const r=await T.getReviewsByEmployeeId(a.id);l(r)}catch(r){console.error("Failed to load reviews",r)}finally{b(!1)}})()},[a.id]);const[j,C]=M("review_drafts",{}),I=t=>{switch(t){case"completed":return"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400";case"in_progress":return"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400";case"pending":return"bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-400";case"scheduled":return"bg-gray-100 dark:bg-slate-700 text-gray-600 dark:text-slate-400";default:return"bg-gray-100 dark:bg-slate-700 text-gray-600 dark:text-slate-400"}},F=t=>{if(!t.selfAssessment)return null;const r=[t.selfAssessment.performanceRating,t.selfAssessment.goalsAchievement,t.selfAssessment.skillsGrowth,t.selfAssessment.teamwork,t.selfAssessment.initiative];return(r.reduce((c,m)=>c+m,0)/r.length).toFixed(1)},u=o.filter(t=>t.status==="pending"||t.status==="in_progress"),w=o.filter(t=>t.status==="completed"),N=o.filter(t=>t.status==="scheduled"),_=t=>{z(t),f(!0)},y=(t,r,c,m)=>{C(x=>{const i=x[t]||{};if(m){const p=i[r],g=typeof p=="object"&&p!==null?p:{};return{...x,[t]:{...i,[r]:{...g,[m]:c}}}}return{...x,[t]:{...i,[r]:c}}})},L=async()=>{var c,m,x,i,p;if(!s)return;const t=j[s.id]||{},r={...s,status:"completed",completedDate:new Date().toISOString(),selfAssessment:{performanceRating:((c=t.Performance)==null?void 0:c.rating)||0,goalsAchievement:((m=t["Goals Achievement"])==null?void 0:m.rating)||0,skillsGrowth:((x=t["Skills Growth"])==null?void 0:x.rating)||0,teamwork:((i=t.Teamwork)==null?void 0:i.rating)||0,initiative:((p=t.Initiative)==null?void 0:p.rating)||0,achievements:(t.achievements||"").split(`
`)}};l(o.map(g=>g.id===s.id?r:g));try{await T.updateReview(r)}catch(g){console.error("Submission failed",g)}f(!1),C(g=>{const E={...g};return delete E[s.id],E})};return d?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(W,{items:[{label:"Work"},{label:"Performance Reviews"}],setActiveView:n}),e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gradient-to-br from-amber-500 to-orange-600 rounded-xl text-white",children:e.jsx(q,{className:"w-6 h-6"})}),"Performance Reviews"]}),e.jsx("p",{className:"text-gray-500 dark:text-slate-400 mt-1",children:"Track your growth and feedback throughout the year"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(h,{variant:"glass",padding:"md",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-slate-400",children:"Pending Reviews"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900 dark:text-white mt-1",children:u.length})]}),e.jsxs(h,{variant:"glass",padding:"md",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-slate-400",children:"Completed This Year"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900 dark:text-white mt-1",children:w.length})]}),e.jsxs(h,{variant:"glass",padding:"md",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-slate-400",children:"Upcoming"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900 dark:text-white mt-1",children:N.length})]}),e.jsxs(h,{variant:"glass",padding:"md",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-slate-400",children:"Average Rating"}),e.jsxs("p",{className:"text-3xl font-bold text-gray-900 dark:text-white mt-1",children:[w.length>0?"4.2":"-","/5"]})]})]}),u.length>0&&e.jsx(h,{variant:"elevated",className:"border-l-4 border-l-amber-500",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Action Required"}),e.jsxs("p",{className:"text-gray-500 dark:text-slate-400 mt-1",children:["You have ",u.length," review(s) that need your attention"]})]}),e.jsx(k,{onClick:()=>u[0]&&_(u[0]),children:"Start Review"})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(h,{variant:"bordered",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Current Reviews"}),e.jsxs("div",{className:"space-y-4",children:[[...u,...N].map(t=>e.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-slate-800/50 rounded-xl hover:bg-gray-100 dark:hover:bg-slate-800 transition-colors cursor-pointer",onClick:()=>_(t),children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-gray-900 dark:text-white",children:[t.period," Review"]}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-slate-400",children:["Due: ",new Date(t.dueDate).toLocaleDateString()]})]}),e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${I(t.status)}`,children:t.status.replace("_"," ")})]}),t.status==="in_progress"&&e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 dark:text-slate-400 mb-1",children:[e.jsx("span",{children:"Progress"}),e.jsx("span",{children:"60%"})]}),e.jsx(K,{value:60,variant:"gradient",size:"sm"})]})]},t.id)),u.length===0&&N.length===0&&e.jsx("p",{className:"text-center text-gray-500 dark:text-slate-400 py-8",children:"No current reviews"})]})]}),e.jsxs(h,{variant:"bordered",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Review History"}),e.jsxs("div",{className:"space-y-4",children:[w.map(t=>e.jsx("div",{className:"p-4 bg-gray-50 dark:bg-slate-800/50 rounded-xl hover:bg-gray-100 dark:hover:bg-slate-800 transition-colors cursor-pointer",onClick:()=>_(t),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-gray-900 dark:text-white flex items-center gap-2",children:[t.period," Review",e.jsx($,{className:"w-4 h-4 text-green-500"})]}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-slate-400",children:["Completed:"," ",t.completedDate?new Date(t.completedDate).toLocaleDateString():"N/A"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:F(t)||"-"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-slate-400",children:"Overall"})]})]})},t.id)),w.length===0&&e.jsx("p",{className:"text-center text-gray-500 dark:text-slate-400 py-8",children:"No completed reviews yet"})]})]})]}),e.jsxs(h,{variant:"glass",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Tips for a Great Self-Assessment"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"p-4 bg-white/50 dark:bg-slate-800/50 rounded-xl",children:[e.jsx("div",{className:"text-2xl mb-2",children:"ðŸ“Š"}),e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:"Use Data"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-slate-400 mt-1",children:"Back up your achievements with specific metrics and examples"})]}),e.jsxs("div",{className:"p-4 bg-white/50 dark:bg-slate-800/50 rounded-xl",children:[e.jsx("div",{className:"text-2xl mb-2",children:"ðŸŽ¯"}),e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:"Align with Goals"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-slate-400 mt-1",children:"Reference your quarterly goals and how you've progressed"})]}),e.jsxs("div",{className:"p-4 bg-white/50 dark:bg-slate-800/50 rounded-xl",children:[e.jsx("div",{className:"text-2xl mb-2",children:"ðŸ’¬"}),e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:"Be Honest"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-slate-400 mt-1",children:"Acknowledge challenges and areas where you want to grow"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-slate-400 mt-4 italic",children:'"The only way to do great work is to love what you do."'})]})]})]}),e.jsx(J,{isOpen:B,onClose:()=>f(!1),title:`${(s==null?void 0:s.period)||""} Performance Review`,size:"xl",children:s&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 dark:bg-slate-800 rounded-xl",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-slate-400",children:"Review Period"}),e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:s.period})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-slate-400",children:"Due Date"}),e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:new Date(s.dueDate).toLocaleDateString()})]}),e.jsx("span",{className:`px-3 py-1 text-sm rounded-full ${I(s.status)}`,children:s.status.replace("_"," ")})]}),(s.status==="pending"||s.status==="in_progress")&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white",children:"Self Assessment"}),["Performance","Goals Achievement","Skills Growth","Teamwork","Initiative"].map(t=>{var x;const r=(x=j[s.id])==null?void 0:x[t],c=typeof r=="object"&&r!==null?r.rating:void 0,m=typeof r=="object"&&r!==null&&r.comment||"";return e.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-slate-800 rounded-xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("label",{className:"font-medium text-gray-900 dark:text-white",children:t}),e.jsx("div",{className:"flex gap-1",children:[1,2,3,4,5].map(i=>e.jsx("button",{onClick:()=>y(s.id,t,i,"rating"),className:`w-8 h-8 rounded-lg text-sm font-medium transition-colors ${c===i?"bg-indigo-600 text-white":"bg-gray-200 dark:bg-slate-700 text-gray-600 dark:text-slate-400 hover:bg-indigo-100 dark:hover:bg-indigo-900/30 hover:text-indigo-600 dark:hover:text-indigo-400"}`,children:i},i))})]}),e.jsx("textarea",{value:m,onChange:i=>y(s.id,t,i.target.value,"comment"),placeholder:`Describe your ${t.toLowerCase()} this period...`,className:"w-full p-3 bg-white dark:bg-slate-700 rounded-lg text-sm text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-slate-500 outline-none focus:ring-2 focus:ring-indigo-500 resize-none",rows:2})]},t)}),e.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-slate-800 rounded-xl",children:[e.jsx("label",{className:"font-medium text-gray-900 dark:text-white mb-3 block",children:"Key Achievements"}),e.jsx("textarea",{value:((P=j[s.id])==null?void 0:P.achievements)||"",onChange:t=>y(s.id,"achievements",t.target.value),placeholder:"List your main accomplishments this period...",className:"w-full p-3 bg-white dark:bg-slate-700 rounded-lg text-sm text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-slate-500 outline-none focus:ring-2 focus:ring-indigo-500 resize-none",rows:4})]}),e.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-slate-800 rounded-xl",children:[e.jsx("label",{className:"font-medium text-gray-900 dark:text-white mb-3 block",children:"Areas for Growth"}),e.jsx("textarea",{value:((G=j[s.id])==null?void 0:G.growth)||"",onChange:t=>y(s.id,"growth",t.target.value),placeholder:"What areas would you like to develop?",className:"w-full p-3 bg-white dark:bg-slate-700 rounded-lg text-sm text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-slate-500 outline-none focus:ring-2 focus:ring-indigo-500 resize-none",rows:3})]})]}),s.status==="completed"&&s.selfAssessment&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white",children:"Your Assessment"}),e.jsx("div",{className:"grid grid-cols-5 gap-3",children:[{label:"Performance",value:s.selfAssessment.performanceRating},{label:"Goals",value:s.selfAssessment.goalsAchievement},{label:"Skills",value:s.selfAssessment.skillsGrowth},{label:"Teamwork",value:s.selfAssessment.teamwork},{label:"Initiative",value:s.selfAssessment.initiative}].map(t=>e.jsxs("div",{className:"text-center p-3 bg-gray-50 dark:bg-slate-800 rounded-xl",children:[e.jsx("p",{className:"text-2xl font-bold text-indigo-600 dark:text-indigo-400",children:t.value}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-slate-400 mt-1",children:t.label})]},t.label))}),e.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-slate-800 rounded-xl",children:[e.jsx("h5",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"Key Achievements"}),e.jsx("ul",{className:"list-disc list-inside space-y-1 text-sm text-gray-600 dark:text-slate-300",children:s.selfAssessment.achievements.map((t,r)=>e.jsx("li",{children:t},r))})]}),s.managerAssessment&&e.jsxs("div",{className:"p-4 bg-indigo-50 dark:bg-indigo-900/20 rounded-xl border border-indigo-200 dark:border-indigo-800",children:[e.jsx("h5",{className:"font-medium text-indigo-900 dark:text-indigo-200 mb-2",children:"Manager Feedback"}),e.jsx("p",{className:"text-sm text-indigo-700 dark:text-indigo-300",children:s.managerAssessment.feedback})]})]}),e.jsx("div",{className:"flex gap-3 pt-4 border-t border-gray-200 dark:border-slate-700",children:s.status==="pending"||s.status==="in_progress"?e.jsxs(e.Fragment,{children:[e.jsx(k,{variant:"secondary",className:"flex-1",onClick:()=>f(!1),children:"Save Draft"}),e.jsx(k,{className:"flex-1",onClick:L,children:"Submit Review"})]}):e.jsx(k,{variant:"secondary",className:"flex-1",onClick:()=>f(!1),children:"Close"})})]})})]})};export{X as default};
